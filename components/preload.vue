<template>
  <div class="preload-container" v-if="visible">
    <div id="preload" :class="{ hidden: step === 3 }">
      <!-- FASE 1: LOGO -->
      <div  class="preload-logo" :class="logoClass">
        <div> 
          <svg  version="1.1" viewBox="0 0 149 96">
            <path class="st0" d="M0,50h9.8c5.5,0,7.2,3.4,7.2,8.7v27.6c0,5.6-1.9,9-7.2,9H0s0-45.4,0-45.4ZM6.4,88.8h1.5c2,0,2.5-1.1,2.5-3.5v-25.6c0-2.6-.6-3.5-2.2-3.5h-1.8v32.6Z"/>
            <path class="st0" d="M29.1,86.9h-4.7s-.8,8.5-.8,8.5h-5.7s5.2-45.4,5.2-45.4h7.6s5.5,45.4,5.5,45.4h-6.2s-.8-8.5-.8-8.5ZM25,80.1h3.3l-1.7-16.8-1.6,16.8Z"/>
            <path class="st0" d="M43.7,95.4h-6.4s0-45.4,0-45.4h10.4c4.3,0,6.4,1.9,6.4,7v8.1c0,3.8-1.6,5.3-2.8,5.8,1.4.7,2.8,1.8,2.8,4.9v15.9c0,1.9.3,2.7.6,3.4v.3h-6.3c-.3-.5-.6-1.3-.6-3.7v-13.7c0-2-.3-2.9-2.4-2.9h-1.6v20.3s0,0,0,0ZM43.7,68.7h1.7c1.8,0,2.3-1.2,2.3-3.2v-6.3c0-2-.3-2.9-2.3-2.9h-1.7v12.5Z"/>
            <path class="st0" d="M62.9,95.4h-6.4s0-45.4,0-45.4h6.4s0,18.2,0,18.2l5-18.2h6.2s-6,21.1-6,21.1l6.6,24.3h-6.6s-5.3-19.7-5.3-19.7v19.7Z"/>
            <path class="st0" d="M90.5,56.6h-8.2s0,11.9,0,11.9h6.4s0,6.9,0,6.9h-6.4s0,13.1,0,13.1h8.5s0,6.9,0,6.9h-14.9s0-45.4,0-45.4h14.6s0,6.6,0,6.6Z"/>
            <path class="st0" d="M98.4,50l5.5,24.3v-24.3s5.8,0,5.8,0v45.4s-5.2,0-5.2,0l-6.1-26.1v26.1s-5.8,0-5.8,0v-45.4s5.8,0,5.8,0Z"/>
            <path class="st0" d="M121.3,49.6c5.3,0,7.3,2.5,7.3,7.9v7.4s-6.2,0-6.2,0v-6.5c0-1.5-.3-2.7-1.8-2.7-1.5,0-1.9,1-1.9,3.2v.9c0,2.6.5,4,2.6,7l4.1,5.7c2.9,4,3.8,6.3,3.8,11.5v1.5c0,6.7-2.6,10.6-8.3,10.6h-1.2c-5.2,0-7.8-3-7.8-8.6v-9.1s6.3,0,6.3,0v7.9c0,2.1.7,3.2,2.1,3.2s2.1-1,2.1-3.9v-1c0-3.3-.3-4.3-2.6-7.6l-4.1-5.6c-2.7-3.8-3.5-6.7-3.5-11.2v-1.5c0-6.1,2.8-8.8,7.9-8.8h1.2,0Z"/>
            <path class="st0" d="M140.4,49.6c5.3,0,7.3,2.5,7.3,7.9v7.4s-6.2,0-6.2,0v-6.5c0-1.5-.3-2.7-1.8-2.7-1.5,0-1.9,1-1.9,3.2v.9c0,2.6.5,4,2.6,7l4.1,5.7c2.9,4,3.8,6.3,3.8,11.5v1.5c0,6.7-2.6,10.6-8.3,10.6h-1.2c-5.2,0-7.8-3-7.8-8.6v-9.1s6.3,0,6.3,0v7.9c0,2.1.7,3.2,2.1,3.2s2.1-1,2.1-3.9v-1c0-3.3-.3-4.3-2.6-7.6l-4.1-5.6c-2.7-3.8-3.5-6.7-3.5-11.2v-1.5c0-6.1,2.8-8.8,7.9-8.8h1.2,0Z"/>
            <path class="st0" d="M18.9.5v38.4s7.8,0,7.8,0v7s-14.2,0-14.2,0V.5s6.4,0,6.4,0Z"/>
            <path class="st0" d="M35,45.9h-6.4s0-45.4,0-45.4h6.4s0,45.4,0,45.4Z"/>
            <path class="st0" d="M43.5,46.5c-3.8,0-6.1-3.6-6.1-8.3V9.8c0-5.1,1.8-9.8,7.9-9.8h1.2c6.9,0,7.6,4.8,7.6,10.2v4.6h-6.2s0-5.1,0-5.1c0-2-.5-3.1-2-3.1-1.3,0-2,1-2,3.1v26.5c0,2.1.7,3.2,2.1,3.2,1.6,0,2.4-1.2,2.4-2.9v-11.3s-2.9,0-2.9,0v-7s9,0,9,0v27.6h-3.6c0-.2-.6-2.5-1.1-4.5-.5,1.5-2.6,5.1-5.8,5.1h-.4Z"/>
            <path class="st0" d="M93,.5v6.6s-5.4,0-5.4,0v38.8s-6.4,0-6.4,0V7.1s-5.4,0-5.4,0V.5s17.1,0,17.1,0Z"/>
            <path class="st0" d="M97,45.3h-3.1v-21.9h3.1v21.9Z"/>
            <path class="st0" d="M101,23.4l2.6,11.8v-11.7h2.8v21.9h-2.5l-2.9-12.6v12.6h-2.8v-21.9h2.8Z"/>
            <path class="st0" d="M118.4,23.4v3.2h-2.6v18.7h-3.1v-18.7s-2.6,0-2.6,0v-3.2h8.3s0,0,0,0Z"/>
            <path class="st0" d="M122.3,45.3h-3.1v-21.9h3.1v8.8s2.1,0,2.1,0v-8.8h3.1v21.9h-3.1v-9.6s-2.1,0-2.1,0v9.6Z"/>
            <path class="st0" d="M135.8,23.4v3.2h-3.9s0,5.7,0,5.7h3.1v3.3h-3.1v6.3s4.1,0,4.1,0v3.3h-7.2s0-21.9,0-21.9h7Z"/>
            <path class="st0" d="M164.2-376.7"/>
            <path class="st0" d="M66.5.5v7.7l-.6.5s1.9,0,1.9,0c0,0-.6,6.4-3.1,11.9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0V.5h-7.6s0,45.4,0,45.4h6.4s.3,0,.3,0c.1-3.3,0-8.2,0-10h0c0,0,0-.1,0-.2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0-.1-.1-.2-.2-.4-.5-.7-1.1-1-1.7-.2-.3-.3-.6-.6-.9-.2-.3-.4-.5-.7-.8,0,0-.2-.2-.3-.3,0,0-.1-.1-.2-.2-.1-.1-.2-.3-.3-.4,0-.4.4-.5.7-.4.2,0,.4.1.6.3.4.3.6.9,1,1.2,0-.2-.1-.4-.2-.6,0-.5-.7-4.5-.6-4.9,0-.1,0-.2.1-.3h0s0,0,0,0c0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.1,0,.5.3,1,.4,1.5,0,.4.2.8.3,1.1,0,.1.2.4.2.5,0,0,0,0,0,0,0,0,0,0,0,0s0,0,0,0c0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0-.5,0-2.5.2-3.4,0-.5,0-1.2.4-1.5,0,0,0,0,0,0,.4-.3.5.5.6.8.1.7.1,3,.1,3.4,0,.2,0,.3,0,.5,0,0,0,0,0,0,0,0,0,0,0,.1,0,0,0,0,0,0,0-.1,0-.2,0-.3,0-.2.1-.5.2-.7.1-.5.7-2.2.9-2.6,0-.2.2-.4.3-.6,0-.2.3-.4.5-.4.3,0,.3.4.2.7,0,.2,0,.3,0,.5,0,.2,0,.5-.1.7,0,.5-.5,2.3-.6,2.7,0,0,0,.2,0,.3,0,0,0,0,0,0,.2,0,1.2-1.8,1.5-2.1,0,0,0-.1.1-.2,0,0,0,0,0,0,.1-.1.4-.3.5,0,0,0,0,.1.1.2h0s0,0,0,0c0,0,0,0,0,0,0,0,0,.1,0,.2,0,0,0,0,0,0,0,0,0,.1,0,.2,0,0,0,0,0,0,0,0,0,.1,0,.2,0,0,0,0,0,0,0,0,0,0,0,0-.1.4-.3.7-.5,1-.2.4-.4.8-.5,1.2,0,.2-.1.4-.2.7,0,.2,0,.5,0,.8,0,.5-.1,1-.3,1.5-.1.4-.3.7-.5,1,0,.4-.3,6.7-.1,10.8h1.1s6.4,0,6.4,0V.5s-7.6,0-7.6,0Z"/>
          </svg>
        </div>
      </div>

      <!-- FASE 2: TESTO -->
      <div v-if="step === 2 && textClass" class="preload-text" :class="textClass">
        <div> 
          <div><span>Use the</span></div>
          
          <div>
            <div class="mini-switch">
              <div class="choseText">Good</div>
              
              <div class="switch simulated">
                <span class="slider_sm round_sim"></span>
              </div>
              
              <div class="choseText">Evil</div>
            </div>
          </div>

          <div><span>for more experience</span></div>
        </div>
      </div>
    </div>

    <!-- FASE 3: COLONNE ANIMATE -->
    <div class="preload-columns">
      <div
        v-for="(delay, index) in delays"
        :key="index"
        class="column"
        :style="{ transitionDelay: `${delay}ms` }"
        :class="{ drop: dropped }"
      ></div>
    </div>
  </div>
</template>

<script setup>
const step = ref(0)
const visible = ref(true)
const dropped = ref(false)
const logoClass = ref('')
const textClass = ref('')
const delays = ref([])
const emit = defineEmits(['done'])

const preloadCompleted = useState('preload-completed', () => false)

const { $lenis } = useNuxtApp()

function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}


onMounted(async () => {



   $lenis?.stop()

  delays.value = Array.from({ length: 10 }, () => Math.floor(Math.random() * 700))


  await wait(500)

  // Solo fade-out
  logoClass.value = 'fadeOut'
  await wait(500)

  // FASE 2: TESTO
  step.value = 2
  textClass.value = 'fadeInOut'
  await wait(4000)

  // FASE 3: COLONNE
  textClass.value = ''
  step.value = 3
  
  dropped.value = true
  await wait(1700)

   // ✅ stato globale aggiornato
  emit('done')                    // ✅ evento per default.vue
  visible.value = false
   preloadCompleted.value = true 

  $lenis?.start()

})
</script>

<style scoped>


</style>
